#! /bin/sh
# This script tests: pamcat
# Also requires: pbmmake pgmramp pgmnoise pamundice ppmtoppm

tmpdir=${tmpdir:-/tmp}
check2x2_pbm=${tmpdir}/check2x2.pbm
maze2lr_pbm=${tmpdir}/maze2lr.pbm
maze2tb_pbm=${tmpdir}/maze2tb.pbm
diag4_pgm=${tmpdir}/diag4.pgm
noise_pgm=${tmpdir}/noise.pgm
noiseh6_pgm=${tmpdir}/noiseh6.pgm
noisev5_pgm=${tmpdir}/noisev5.pgm
diag8_ppm=${tmpdir}/diag8.ppm
diag2h_ppm=${tmpdir}/diag2h.ppm
diag2v_ppm=${tmpdir}/diag2v.ppm

echo "Test 1.  Should print a simple PBM image five times"
# Check input from stdin and from designated input file
# Similar to tests in stdin-p?m.test

pbmmake -g 2 2 | tee ${check2x2_pbm} | pamcat -lr -plain
pamcat -tb -plain ${check2x2_pbm}
pamcat -tb -plain < ${check2x2_pbm}
pamcat -lr -black -plain ${check2x2_pbm}
cat ${check2x2_pbm} | pamcat -tb -white -plain


echo "Test 2.  Should print 3141425598 9 fourteen times"
for opt in "-leftright" "-lr" "-lr -jtop" "-lr -jcenter" "-lr -jbottom" \
    "-lr -white" "-lr -black" \
    "-topbottom" "-tb" "-tb -jleft"  "-tb -jcenter" "-tb --jright" \
    "-tb -white" "-tb -black"
  do
  pamcat ${opt} ${check2x2_pbm} | cksum
  done

rm ${check2x2_pbm}


echo "Test 3.  Should print 2197356643 895 eight times"
pamcat -lr -white maze.pbm maze.pbm | tee ${maze2lr_pbm} | cksum
for opt in "-leftright" "-lr -jtop" "-lr -jcenter" "-lr -jbottom" \
    "-lr -white" "-lr -black"
  do
  pamcat ${opt} maze.pbm maze.pbm | cksum
  done


cat maze.pbm | pamcat -lr -black maze.pbm - | cksum

echo "Test 4.  Should print 3313353797 954 seven times"
pamcat -tb maze.pbm maze.pbm | tee ${maze2tb_pbm} | cksum
for opt in "-topbottom" "-tb -jleft"  "-tb -jcenter" "-tb --jright" \
    "-tb -white" "-tb -black"
  do
  pamcat ${opt} maze.pbm maze.pbm | cksum
  done


echo "Test 5.  Should print 1731660895 1308 ten times"
pamcat -lr maze.pbm maze.pbm maze.pbm | cksum
for opt in "-leftright" "-lr" "-lr -jtop" "-lr -jcenter" "-lr -jbottom" \
    "-lr -white" "-lr -black"
  do
  pamcat ${opt} ${maze2lr_pbm} maze.pbm | cksum
  done
pamcat -lr maze.pbm ${maze2lr_pbm} | cksum
cat ${maze2lr_pbm} | pamcat -lr - maze.pbm | cksum


echo "Test 6.  Should print 2985957591 1426 ten times"
for opt in  "-topbottom" "-tb" "-tb -jleft"  "-tb -jcenter" "-tb --jright" \
    "-tb -white" "-tb -black"
  do
  pamcat ${opt} ${maze2tb_pbm} maze.pbm | cksum
  done
pamcat -tb maze.pbm maze.pbm maze.pbm | cksum
pamcat -tb maze.pbm ${maze2tb_pbm} | cksum
cat maze.pbm | pamcat -tb - ${maze2tb_pbm} | cksum

rm ${maze2lr_pbm} ${maze2tb_pbm}


echo "Test 7.  Should print a simple PGM image three times"
# Use sed to scrape off space at line end for compatibility
# with older versions of pamcat

pgmramp -diag 4 4 -maxval=3 | tee ${diag4_pgm} | pamcat -lr -plain |\
  sed 's/ *$//'
pamcat -tb -plain ${diag4_pgm} | sed 's/ *$//'
cat ${diag4_pgm} | pamcat -tb -plain | sed 's/ *$//'


pgmnoise -randomseed=100 4 4 > ${noise_pgm}

echo "Test 8.  Should print match fourteen times"

for opt in "-leftright" "-lr" "-lr -jtop" "-lr -jcenter" "-lr -jbottom" \
			"-lr -white" "-lr -black" \
			"-topbottom" "-tb" "-tb -jleft" "-tb -jcenter" "-tb --jright" \
	                "-tb -white" "-tb -black"
do
    pamcat ${opt} ${noise_pgm} | cmp -s ${noise_pgm} - && echo "match" || echo "no match"
done


echo ${noise_pgm} ${noise_pgm} ${noise_pgm} ${noise_pgm} ${noise_pgm} ${noise_pgm} | \
    tr ' ' '\n' | pamundice -across 6 -listfile=- > ${noiseh6_pgm}

echo "Test 9.  Should print match nine times"
for opt in "-leftright" "-lr" "-lr -jtop" "-lr -jcenter" "-lr -jbottom" \
			"-lr -white" "-lr -black"
do
    pamcat ${opt} ${noise_pgm} ${noise_pgm} ${noise_pgm} \
	  ${noise_pgm} ${noise_pgm} ${noise_pgm} | \
    cmp -s ${noiseh6_pgm} - && echo "match" || echo "no match"

done
pamcat -lr ${noise_pgm} ${noise_pgm} | \
    pamcat -lr - ${noise_pgm} ${noise_pgm} ${noise_pgm} ${noise_pgm} | \
        cmp -s ${noiseh6_pgm} - && echo "match" || echo "no match"

pamcat -lr ${noise_pgm} ${noise_pgm} ${noise_pgm} | \
    pamcat -lr ${noise_pgm} - ${noise_pgm} ${noise_pgm} | \
    cmp -s ${noiseh6_pgm} - && echo "match" || echo "no match"

rm ${noiseh6_pgm}


echo ${noise_pgm} ${noise_pgm} ${noise_pgm} ${noise_pgm} ${noise_pgm} | \
    tr ' ' '\n' | pamundice -down 5 -listfile=- > ${noisev5_pgm}

echo "Test 10.  Should print match nine times"
for opt in "-topbottom" "-tb" "-tb -jleft" "-tb -jcenter" "-tb --jright" \
	                "-tb -white" "-tb -black"
do
    pamcat ${opt} ${noise_pgm} ${noise_pgm} ${noise_pgm} ${noise_pgm} ${noise_pgm} | \
	cmp -s ${noisev5_pgm} - && echo "match" || echo "no match"
done
pamcat -tb ${noise_pgm} ${noise_pgm} ${noise_pgm} | \
    pamcat -tb ${noise_pgm} ${noise_pgm} - | \
    cmp -s ${noisev5_pgm} - && echo "match" || echo "no match"    
pamcat -tb ${noise_pgm} ${noise_pgm} ${noise_pgm} ${noise_pgm} | \
    pamcat -tb - ${noise_pgm} | \
    cmp -s ${noisev5_pgm} - && echo "match" || echo "no match"     
rm ${noise_pgm} ${noisev5_pgm}


pgmramp -diag 8 8 -maxval 7 | ppmtoppm > ${diag8_ppm}

echo "Test 11.  Should print 2097565808 394 eight times"
for opt in "-leftright" "-lr" "-lr -jtop" "-lr -jcenter" "-lr -jbottom" \
    "-lr -white" "-lr -black"
  do
  pamcat ${opt} ${diag8_ppm} ${diag8_ppm} | cksum
  done
cat ${diag8_ppm} | pamcat -lr -white ${diag8_ppm} - | tee ${diag2h_ppm} | cksum


echo "Test 12.  Should print 3086569577 394"
pamcat -tb ${diag8_ppm} ${diag8_ppm} | tee ${diag2v_ppm} | cksum


echo "Test 13.  Should print 4288335051 586 three times"
pamcat -lr ${diag8_ppm} ${diag8_ppm} ${diag8_ppm} | cksum
pamcat -lr ${diag8_ppm}  ${diag2h_ppm} | cksum
cat ${diag2h_ppm} | pamcat -lr - ${diag8_ppm} | cksum


echo "Test 14.  Should print 642720605 586 nine times"

for opt in "-topbottom" "-tb" "-tb -jleft"  "-tb -jcenter" "-tb --jright" \
    "-tb -white" "-tb -black"
  do
  pamcat ${opt} ${diag8_ppm} ${diag8_ppm} ${diag8_ppm} | cksum
  done
pamcat -tb ${diag2v_ppm} ${diag8_ppm} | cksum
cat ${diag8_ppm} | pamcat -tb ${diag2v_ppm} - | cksum

rm ${diag2h_ppm} ${diag2v_ppm}


echo "Test 15.  Should print 3622741282 1019 twice"
pamcat -tb -white testgrid.pbm ${diag8_ppm} | cksum
pamcat -tb -jcenter -white testgrid.pbm ${diag8_ppm} | cksum

echo "Test 16.  Should print 1401081637 1019"
pamcat -tb -jleft -white testgrid.pbm ${diag8_ppm}  | cksum

echo "Test 17.  Should print 2756501917 1019"
pamcat -tb -jright -white testgrid.pbm ${diag8_ppm} | cksum

echo "Test 18. Should print 587933655 107742 twice"
pamcat -lr -black testgrid.pbm testimg.ppm | cksum
pamcat -lr -jcenter -black testgrid.pbm testimg.ppm | cksum

echo "Test 19.  Should print 3948141157 107742"
pamcat -lr -jtop -black testgrid.pbm testimg.ppm | cksum

echo "Test 20.  Should print 3910239002 107742"
pamcat -lr -jbottom -black testgrid.pbm testimg.ppm | cksum

rm ${diag8_ppm}
