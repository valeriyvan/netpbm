#! /bin/sh
# This script tests: pamflip
# Also requires: ppmpat pamseq pamtopnm

tmpdir=${tmpdir:-/tmp}
tartan_ppm=${tmpdir}/test.ppm
test1_pgm=${tmpdir}/test1.pgm
test2_pgm=${tmpdir}/test2.pgm
dot_p_ppm=${tmpdir}/dot.p.ppm
dot_ppm=${tmpdir}/dot.ppm
dot_plain_ppm=${tmpdir}/dot.plain.ppm

# define function
cmptarget () { cmp -s - $1 && echo "match" || echo "no match";  }

echo "Test 1.  Should print match fifteen times"

ppmpat -tartan -mesh \
       -color=rgb:0/0/0,rgb:ff/00/ff,rgb:80/90/20 31 32 > ${tartan_ppm}

pamflip -null ${tartan_ppm} | \
  cmptarget ${tartan_ppm}

pamflip -lr ${tartan_ppm} | pamflip -lr | \
  cmptarget ${tartan_ppm}

pamflip -tb ${tartan_ppm} | pamflip -tb | \
  cmptarget ${tartan_ppm}

pamflip -r180 ${tartan_ppm} | pamflip -r180 | \
  cmptarget ${tartan_ppm}

pamflip -xy ${tartan_ppm} | pamflip -xy | \
  cmptarget ${tartan_ppm}

pamflip -r90 ${tartan_ppm} | pamflip -r90 | \
  pamflip -r90 | pamflip -r90 | \
  cmptarget ${tartan_ppm}

pamflip -r270 ${tartan_ppm} | pamflip -r270 | \
  pamflip -r270 | pamflip -r270 | \
  cmptarget ${tartan_ppm}

pamflip -xform=leftright ${tartan_ppm} | pamflip -leftright | \
  cmptarget ${tartan_ppm}

pamflip -xform=topbottom ${tartan_ppm} | pamflip -topbottom | \
  cmptarget ${tartan_ppm}

pamflip -xform=transpose ${tartan_ppm} | pamflip -transpose | \
  cmptarget ${tartan_ppm}

pamflip -xform=leftright,leftright ${tartan_ppm} | \
  cmptarget ${tartan_ppm}

pamflip -xform=topbottom,topbottom ${tartan_ppm} | \
  cmptarget ${tartan_ppm}

pamflip -xform=transpose,transpose ${tartan_ppm} | \
  cmptarget ${tartan_ppm}

pamflip -tb ${tartan_ppm} | pamflip -lr | \
  pamflip -xform=leftright,topbottom | \
  cmptarget ${tartan_ppm}

pamflip -tb ${tartan_ppm} | pamflip -lr | pamflip -xy | \
  pamflip -xform=leftright,topbottom,transpose | \
  cmptarget ${tartan_ppm}

echo "Should print 1988581932 2989"
cat ${tartan_ppm} | cksum

rm ${tartan_ppm}

pamseq 1 15 | pamtopnm -assume > ${test1_pgm}

echo "Test 2.  Should print match nine times"
pamflip -null ${test1_pgm} | \
  cmptarget ${test1_pgm}

pamflip -lr ${test1_pgm} | pamflip -lr | \
  cmptarget ${test1_pgm}

pamflip -tb ${test1_pgm} | pamflip -tb | \
  cmptarget ${test1_pgm}

pamflip -r180 ${test1_pgm} | pamflip -r180 | \
  cmptarget ${test1_pgm}

pamflip -xy ${test1_pgm} | pamflip -xy | \
  cmptarget ${test1_pgm}

pamflip -r90 ${test1_pgm} | pamflip -r270 | \
  cmptarget ${test1_pgm}

pamflip -r270 ${test1_pgm} | pamflip -r90 | \
  cmptarget ${test1_pgm}

pamflip -r90 ${test1_pgm} | pamflip -r90 | \
  pamflip -r90 | pamflip -r90 | \
  cmptarget ${test1_pgm}

pamflip -r270 ${test1_pgm} | pamflip -r270 | \
  pamflip -r270 | pamflip -r270 | \
  cmptarget ${test1_pgm}

echo "Should print 2729474106 27"
cat ${test1_pgm} | cksum

pamflip -r180 ${test1_pgm} > ${test2_pgm}
rm ${test1_pgm}

echo "Test 3."

echo "Should print match nine times"
pamflip -null ${test2_pgm} | \
  cmptarget ${test2_pgm}

pamflip -lr ${test2_pgm} | pamflip -lr | \
  cmptarget ${test2_pgm}

pamflip -tb ${test2_pgm} | pamflip -tb | \
  cmptarget ${test2_pgm}

pamflip -r180 ${test2_pgm} | pamflip -r180 | \
  cmptarget ${test2_pgm}

pamflip -xy ${test2_pgm} | pamflip -xy | \
  cmptarget ${test2_pgm}

pamflip -r90 ${test2_pgm} | pamflip -r270 | \
  cmptarget ${test2_pgm}

pamflip -r270 ${test2_pgm} | pamflip -r90 | \
  cmptarget ${test2_pgm}

pamflip -r90 ${test2_pgm} | pamflip -r90 | \
    pamflip -r90 | pamflip -r90 | \
  cmptarget ${test2_pgm}

pamflip -r270 ${test2_pgm} | pamflip -r270 | \
    pamflip -r270 | pamflip -r270 | \
  cmptarget ${test2_pgm}

echo "Should print 1849343241 27"
cat ${test2_pgm} | cksum

rm ${test2_pgm}


echo "Test 4. Should print a single pixel PPM image maxval 65535 in"
echo "plain (ascii) format; then match fifteen times"

cat > ${dot_plain_ppm} <<EOF
P3
1 1
65535
1 10000 65535
EOF

cat ${dot_plain_ppm} | pamflip -null | tee ${dot_ppm} | pamflip -null -plain
rm ${dot_plain_ppm}

# The next seven are not round-trip
pamflip -null ${dot_ppm} | \
  cmptarget ${dot_ppm}

pamflip -lr ${dot_ppm} | \
  cmptarget ${dot_ppm}

pamflip -tb ${dot_ppm} | \
  cmptarget ${dot_ppm}

pamflip -xy ${dot_ppm} | \
  cmptarget ${dot_ppm}

pamflip -r90 ${dot_ppm} | \
  cmptarget ${dot_ppm}

pamflip -r180 ${dot_ppm} | \
  cmptarget ${dot_ppm}

pamflip -r270 ${dot_ppm} | \
  cmptarget ${dot_ppm}


pamflip -lr ${dot_ppm} | pamflip -lr | \
  cmptarget ${dot_ppm}

pamflip -tb ${dot_ppm} | pamflip -tb | \
  cmptarget ${dot_ppm}

pamflip -r180 ${dot_ppm} | pamflip -r180 | \
  cmptarget ${dot_ppm}

pamflip -xy ${dot_ppm} | pamflip -xy | \
  cmptarget ${dot_ppm}

pamflip -r90 ${dot_ppm} | pamflip -r270 | \
  cmptarget ${dot_ppm}

pamflip -r270 ${dot_ppm} | pamflip -r90 | \
  cmptarget ${dot_ppm}

pamflip -r90 ${dot_ppm} | pamflip -r90 | pamflip -r90 | pamflip -r90 | \
  cmptarget ${dot_ppm}

pamflip -r270 ${dot_ppm} | pamflip -r270 | \
  pamflip -r270 | pamflip -r270 | \
  cmptarget ${dot_ppm}
 

echo "Should print 2434897823 19"
cat ${dot_ppm} | cksum

rm ${dot_ppm}

exit

echo "Test 5.  Should print 281226646 481 seven times"

pamflip -null maze.pbm | \
  cmptarget maze.pbm

pamflip -lr maze.pbm | pamflip -lr | \
  cmptarget maze.pbm

pamflip -tb maze.pbm | pamflip -tb | \
  cmptarget maze.pbm

pamflip -r180 maze.pbm | pamflip -r180 | \
  cmptarget maze.pbm

pamflip -xy maze.pbm | pamflip -xy | \
  cmptarget maze.pbm

pamflip -r90 maze.pbm | pamflip -r90 | pamflip -r90 | pamflip -r90 | \
  cmptarget maze.pbm

pamflip -r270 maze.pbm | pamflip -r270 | pamflip -r270 | pamflip -r270 | \
  cmptarget maze.pbm

