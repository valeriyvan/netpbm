#! /bin/sh
# This script tests: pamcat
# Also requires: pamseq pamrestack pamenlarge

tmpdir=${tmpdir:-/tmp}

seq2_4h_pam=${tmpdir}/seq2_4h.pam
seq2_4h4_pam=${tmpdir}/seq2_4h4.pam
seq2_4v_pam=${tmpdir}/seq2_4v.pam
seq2_4v3_pam=${tmpdir}/seq2_4v3.pam



echo "Test 1.  Should print 2700536985 95, then 0 twelve times"
pamseq 2 4 | tee ${seq2_4h_pam} | cksum
for opt in "-leftright" "-lr -jtop" "-lr -jcenter" "-lr -jbottom" \
    "-lr -white" "-lr -black" \
    "-topbottom" "-tb -jleft"  "-tb -jcenter" "-tb --jright" \
    "-tb -white" "-tb -black"
  do
  pamcat ${opt} ${seq2_4h_pam}  |\
  cmp -s ${seq2_4h_pam} - ; echo $?
  done


echo "Test 2.  Should print 2193235886 195, 0 eight times, 1 once"
pamrestack -width=1 ${seq2_4h_pam} | tee ${seq2_4v_pam} |\
  pamenlarge -xscale=3 |\
  tee ${seq2_4v3_pam} | cksum
pamcat -lr ${seq2_4v_pam} ${seq2_4v_pam} | pamcat -lr - ${seq2_4v_pam} |\
  cmp -s ${seq2_4v3_pam} - ; echo $?
pamcat -lr ${seq2_4v_pam} | pamcat -lr - ${seq2_4v_pam}  ${seq2_4v_pam} |\
  cmp -s ${seq2_4v3_pam} - ; echo $?
for opt in "-leftright" "-lr -jtop" "-lr -jcenter" "-lr -jbottom" \
    "-lr -white" "-lr -black" \
    "-topbottom"
  do
  pamcat ${opt} ${seq2_4v_pam} ${seq2_4v_pam} ${seq2_4v_pam} |\
  cmp -s ${seq2_4v3_pam} - ; echo $?
  done


echo "Test 3.  Should print 2773166369 245, 0 nine times, 1 once"
pamenlarge -yscale 4 ${seq2_4h_pam} | tee ${seq2_4h4_pam} | cksum
pamcat -tb ${seq2_4h_pam} |\
    pamcat -tb - ${seq2_4h_pam} ${seq2_4h_pam} ${seq2_4h_pam} |\
    cmp -s ${seq2_4h4_pam} - ; echo $?
pamcat -tb ${seq2_4h_pam} ${seq2_4h_pam} |\
    pamcat -tb - ${seq2_4h_pam} ${seq2_4h_pam} |\
    cmp -s ${seq2_4h4_pam} - ; echo $?
pamcat -tb ${seq2_4h_pam} ${seq2_4h_pam} ${seq2_4h_pam}|\
    pamcat -tb - ${seq2_4h_pam} |\
    cmp -s ${seq2_4h4_pam} - ; echo $?
for opt in "-topbottom" "-tb -jleft"  "-tb -jcenter" "-tb --jright" \
    "-tb -white" "-tb -black" \
    "-leftright"
  do
  pamcat ${opt} ${seq2_4h_pam} ${seq2_4h_pam} ${seq2_4h_pam} ${seq2_4h_pam} |\
  cmp -s ${seq2_4h4_pam} - ; echo $?
  done

rm ${seq2_4h_pam} ${seq2_4v_pam} ${seq2_4v3_pam} ${seq2_4h4_pam}



echo "Test Invalid"

. ./test-invalid.inc

# direction not specified
invCmd "pamcat testgrid.pbm testimg.ppm"

# both directions specified
invCmd "pamcat -topbottom -leftright testgrid.pbm testimg.ppm"

# both pad colors specified
invCmd "pamcat -topbottom -white -black testgrid.pbm testimg.ppm"

# justification parameters overspecified
invCmd "pamcat -lr -jtop -jbottom testgrid.pbm testimg.ppm"
invCmd "pamcat -lr -jtop -jcenter testgrid.pbm testimg.ppm"
invCmd "pamcat -lr -jcenter -jbottom testgrid.pbm testimg.ppm"
invCmd "pamcat -tb -jleft -jright testgrid.pbm testimg.ppm"
invCmd "pamcat -tb -jleft -jcenter testgrid.pbm testimg.ppm"
invCmd "pamcat -tb -jcenter -jright testgrid.pbm testimg.ppm"

# justification parameter in the wrong direction
invCmd "pamcat -lr -jleft    testgrid.pbm testimg.ppm"
invCmd "pamcat -lr -jright   testgrid.pbm testimg.ppm"
invCmd "pamcat -tb -jtop     testgrid.pbm testimg.ppm"
invCmd "pamcat -tb -jbottom  testgrid.pbm testimg.ppm"

# more than one input image from standard input
cat testgrid.pbm | pamcat -lr - - testimg.ppm > ${test_out} || \
  printf "Expected failure 14 "
  test -s ${test_out} && echo "unexpected output" || echo "(no output)"
  rm -f ${test_out}
